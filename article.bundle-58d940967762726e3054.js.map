{"version":3,"file":"article.bundle-58d940967762726e3054.js","mappings":"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","sources":["webpack:///./src/js/pages/article/article-controller.js","webpack:///./src/js/pages/article/article.js"],"sourcesContent":["import {controller} from 'crizmas-mvc';\nimport Form from 'crizmas-form';\n\nimport * as articleApi from '../../api/article';\nimport {currentUser} from '../../models/user';\nimport {Article} from '../../models/article';\nimport router from '../../router';\nimport userController from '../../controllers/user';\nimport articleController from '../../controllers/article';\n\nexport default controller(function ArticleController() {\n  const ctrl = {\n    article: null,\n    currentUser,\n    form: null\n  };\n\n  ctrl.onEnter = () => {\n    const slug = router.params.get('slug');\n    const articlesPromise = ctrl.getArticle(slug);\n\n    articlesPromise.then(() => {\n      ctrl.getComments(slug);\n    });\n\n    return articlesPromise.then(\n      init,\n\n      () => {\n        router.transitionTo('/');\n\n        return false;\n      }\n    );\n  };\n\n  const init = () => {\n    ctrl.form = new Form({\n      actions: {\n        submit: () => {\n          ctrl.postComment(ctrl.form.getResult());\n        }\n      }\n    });\n  };\n\n  ctrl.getArticle = (slug) => {\n    return articleApi.getArticle({slug}).then(({article}) => {\n      ctrl.article = new Article(article);\n    });\n  };\n\n  ctrl.getComments = (slug) => {\n    return articleApi.getArticleComments({slug}).then(({comments}) => {\n      ctrl.article.setComments(comments);\n    });\n  };\n\n  ctrl.deleteArticle = () => {\n    return articleApi.deleteArticle({slug: ctrl.article.slug}).then(() => {\n      router.transitionTo('/');\n    });\n  };\n\n  ctrl.setFollowing = () => {\n    return userController.setFollowing(ctrl.article.author);\n  };\n\n  ctrl.setFavorite = () => {\n    return articleController.setFavorite(ctrl.article);\n  };\n\n  ctrl.postComment = (comment) => {\n    if (!currentUser.isAuthenticated) {\n      return router.transitionTo('/register');\n    }\n\n    return articleApi.postComment({slug: ctrl.article.slug, comment}).then(({comment}) => {\n      ctrl.article.addComment(comment);\n      ctrl.form.clear();\n    });\n  };\n\n  ctrl.deleteComment = (commentId) => {\n    return articleApi.deleteComment({slug: ctrl.article.slug, commentId}).then(() => {\n      ctrl.article.deleteComment(commentId);\n    });\n  };\n\n  return ctrl;\n});\n","import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {Link} from 'crizmas-router';\nimport {Input} from 'crizmas-components';\nimport marked from 'marked';\nimport classNames from 'classnames';\n\nimport ArticleAuthor from '../../components/article-author';\nimport TagList from '../../components/tag-list';\nimport {longDate} from '../../date-utils';\n\nexport default class Article extends Component {\n  constructor() {\n    super();\n\n    this.onDelete = () => {\n      this.props.controller.deleteArticle();\n    };\n\n    this.setFollowing = () => {\n      this.props.controller.setFollowing();\n    };\n\n    this.setFavorite = () => {\n      this.props.controller.setFavorite();\n    };\n\n    this.onSubmit = (e) => {\n      e.preventDefault();\n      this.props.controller.form.submit();\n    };\n  }\n\n  renderArticleMeta() {\n    const {article, currentUser, pending} = this.props.controller;\n\n    return <div className=\"article-meta\">\n      <ArticleAuthor article={article} />\n\n      {article.author.username === currentUser.username && <span>\n        <Link\n          to={`/editor/${article.slug}`}\n          className=\"btn btn-sm btn-outline-secondary\">\n          <i className=\"ion-edit\" />&nbsp;\n          Edit Article\n        </Link>\n        &nbsp;\n        <button\n          className=\"btn btn-sm btn-outline-danger\"\n          onClick={this.onDelete}\n          disabled={pending.has('deleteArticle')}>\n          <i className=\"ion-trash-a\" />&nbsp;\n          Delete Article\n        </button>\n      </span>}\n      {article.author.username !== currentUser.username && <span>\n        <button\n          className={classNames('btn btn-sm', {\n            'btn-secondary': article.author.following,\n            'btn-outline-secondary': !article.author.following\n          })}\n          onClick={this.setFollowing}\n          disabled={pending.has('setFollowing')}>\n          <i className=\"ion-plus-round\" />&nbsp;\n          {article.author.following ? 'Unfollow' : 'Follow'} {article.author.username}\n        </button>\n        &nbsp;\n        <button\n          className={classNames('btn btn-sm', {\n            'btn-primary': article.favorited,\n            'btn-outline-primary': !article.favorited\n          })}\n          onClick={this.setFavorite}\n          disabled={pending.has('setFavorite')}>\n          <i className=\"ion-heart\" />&nbsp;\n          {article.favorited ? 'Unfavorite Article' : 'Favorite Article'}\n          ({article.favoritesCount})\n        </button>\n      </span>}\n    </div>;\n  }\n\n  render() {\n    const {article, article: {comments}, currentUser, form, deleteComment} = this.props.controller;\n\n    return <div className=\"article-page\">\n      <div className=\"banner\">\n        <div className=\"container\">\n          <h1>{article.title}</h1>\n\n          {this.renderArticleMeta()}\n        </div>\n      </div>\n\n      <div className=\"container page\">\n        <div className=\"row article-content\">\n          <div className=\"col-md-12\">\n            <div dangerouslySetInnerHTML={{__html: marked(article.body)}} />\n            <TagList article={article} />\n          </div>\n        </div>\n\n        <hr />\n\n        <div className=\"article-actions\">\n          {this.renderArticleMeta()}\n        </div>\n\n        <div className=\"row\">\n          <div className=\"col-xs-12 col-md-8 offset-md-2\">\n            <form className=\"card comment-form\" onSubmit={this.onSubmit}>\n              <div className=\"card-block\">\n                <Input\n                  type=\"textarea\"\n                  inputClassName=\"form-control\"\n                  placeholder=\"Write a comment...\"\n                  inputProps={{rows: \"3\"}}\n                  {...form} />\n              </div>\n              <div className=\"card-footer\">\n                <img\n                  src={currentUser.image}\n                  className=\"comment-author-img\" />\n                <button className=\"btn btn-sm btn-primary\">Post Comment</button>\n              </div>\n            </form>\n\n            {comments && !!comments.length && comments.map((comment, i) => <div\n              key={i}\n              className=\"card\">\n              <div className=\"card-block\">\n                <p className=\"card-text\">\n                  {comment.body}\n                </p>\n              </div>\n              <div className=\"card-footer\">\n                <Link\n                  to={`/@${encodeURIComponent(comment.author.username)}`}\n                  className=\"comment-author\">\n                  <img src={comment.author.image} className=\"comment-author-img\" />\n                </Link>\n                &nbsp;&nbsp;\n                <Link\n                  to={`/@${encodeURIComponent(comment.author.username)}`}\n                  className=\"comment-author\">{comment.author.username}</Link>\n                <span className=\"date-posted\">{longDate(comment.createdAt)}</span>\n                {comment.author.username === currentUser.username && <span className=\"mod-options\">\n                  <i className=\"ion-trash-a\" onClick={deleteComment.bind(null, comment.id)} />\n                </span>}\n              </div>\n            </div>)}\n          </div>\n        </div>\n      </div>\n    </div>;\n  }\n}\n\nArticle.propTypes = {\n  controller: PropTypes.object.isRequired\n};\n"],"names":["controller","ctrl","article","currentUser","form","slug","router","articlesPromise","getArticle","then","getComments","init","Form","actions","submit","postComment","getResult","articleApi","Article","comments","setComments","deleteArticle","setFollowing","userController","author","setFavorite","articleController","comment","addComment","clear","deleteComment","commentId","Component","constructor","super","this","onDelete","props","onSubmit","e","preventDefault","renderArticleMeta","pending","className","username","to","onClick","disabled","has","classNames","following","favorited","favoritesCount","render","title","dangerouslySetInnerHTML","__html","marked","body","type","inputClassName","placeholder","inputProps","rows","src","image","length","map","i","key","encodeURIComponent","longDate","createdAt","bind","id","propTypes","PropTypes"],"sourceRoot":""}